<!doctype html>

<html>
	<head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">
		<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
		<title>Unstable</title>

		<script type="text/javascript" src="../src/classlist.js"	></script>

		<!-- The solar system game engine -->
		<script type="text/javascript" src="../src/util.js"			></script>
		<script type="text/javascript" src="../src/v.js"			></script>
		<script type="text/javascript" src="../src/body.js"			></script>
		<script type="text/javascript" src="../src/solarsystem.js"	></script>

		<!-- Optional features of the solar system game engine -->
		<script type="text/javascript" src="../src/zoom.js"			></script>
		<script type="text/javascript" src="../src/drag-bodies.js"	></script>

		<script type="text/javascript" src="game.js"				></script>
		<script type="text/javascript" src="levels.js"				></script>
		<script type="text/javascript" src="menu.js"				></script>
		<script type="text/javascript" src="preview.js"				></script>

		<style tyle="text/css">
			@import url('game.css');
		</style>
	</head>

	<body>
		<script>
			var menubg			= new MenuBackdrop();
			var game			= new UnstableGame();
			var levelPreview	= new LevelPreview();

			function showSection(name)
			{
				var sections	= document.getElementsByClassName('content');
				var section		= document.getElementById(name);

				for (var i = 0, s; s = sections[i]; i++) {
					s.style.display = 'none';
				}

				if (section) {
					section.style.display = 'block';
				}
			}

			window.addEventListener('load', function()
			{
				showMenu(window.location.hash.substring(1));

				/* Enable some options */
				if (document.body.requestFullScreen		||
					document.body.msRequestFullScreen	||
					document.body.mozRequestFullScreen	||
					document.body.webkitRequestFullScreen
				) {
					var f = document.getElementById('fullscreen');

					// TODO	Save this setting and apply it on startup

					// TODO	Allow going fullscreen using a command line arg when
					//		running with xulrunner

					// TODO	Add options for mapping inputs with keyboard and/or
					//		gamepads

					f.disabled = false;
					f.addEventListener('change', function()
					{
						if (f.checked) {
							if (document.body.requestFullscreen) {
								document.body.requestFullscreen();
							} else if (document.body.msRequestFullscreen) {
								document.body.msRequestFullscreen();
							} else if (document.body.mozRequestFullScreen) {
								document.body.mozRequestFullScreen();
							} else if (document.body.webkitRequestFullscreen) {
								document.body.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
							}

							/* This is required when running in xulrunner */
							setTimeout(function() {
								window.fullScreen = true;
							}, 1);
						} else {
							if (document.exitFullscreen) {
								document.exitFullscreen();
							} else if (document.msExitFullscreen) {
								document.msExitFullscreen();
							} else if (document.mozCancelFullScreen) {
								document.mozCancelFullScreen();
							} else if (document.webkitExitFullscreen) {
								document.webkitExitFullscreen();
							}

							/* This is required when running in xulrunner */
							setTimeout(function() {
								window.fullScreen = false;
							}, 1);
						}
					});
				}
			});

			function loadLevel(level)
			{
				var btn;

				if ((btn = document.getElementById('playbtn'))) {
					btn.innerHTML = '';
					btn.appendChild(document.createTextNode('Resume'));
				}



				document.getElementById('menu').style.display = 'none';
				document.getElementById('game').style.display = 'block';

				menubg.hide();

				if (!isNaN(level)) {
					game.loadLevel(level);
				}

				game.show();
			}

			function showMenu(section)
			{
				document.getElementById('menu').style.display = 'block';
				document.getElementById('game').style.display = 'none';

				showSection(section);

				/* Update the level list based on the player's progress */
				levelPreview.getMenu(document.getElementById('level'), loadLevel);

				game.hide();
				menubg.show();
			}
		</script>

		<div id="menu">
			<div class="title">Unstable</div>

			<div class="menu">
				<!-- Text changes to 'Resume' when a level is loaded -->
				<a id="playbtn" onclick="loadLevel();">Play</a>

				&nbsp;&nbsp;|&nbsp;&nbsp;<a onclick="showSection('level'	);">Choose a Level</a>
				&nbsp;&nbsp;|&nbsp;&nbsp;<a onclick="loadLevel(-1			);">Playground</a>
				&nbsp;&nbsp;|&nbsp;&nbsp;<a onclick="showSection('options'	);">Options</a>
				&nbsp;&nbsp;|&nbsp;&nbsp;<a onclick="showSection('about'	);">About</a>
<!--
				&nbsp;&nbsp;|&nbsp;&nbsp;<a onclick="showSection('help'		);">Help</a>
-->
			</div>

			<!--
				TODO: Find a way to open links in a new window when launched
				from the xulrunner wrapper. Right now they open in the same
				window even with the target set.
			-->
			<div id="about" class="content">
				<div class="center">A</div>
				<div class="center">
					<a target="_blank" href="https://github.com/smogheap/idle/blob/master/SMOGHEAP-CHARTER">
						<img src="smogheap.png">
					</a>
				</div>
				<div class="center">game</div>
				<br/>

				<p>
					In unstable you are presented with an unstable solar system.
					Your job is to make it stable. By moving suns, planets and
					moons and changing their velocities you can make each solar
					system stable (at least for a while).
				</p>

				<p>
					Created by Micah N Gorrell. Special thanks to Owen
					Swerkstrom, Rodney Price and many others.
				</p>

				<p>
					This game is avaliable as open source under the GPLv3
					license. You may access the original source and license at
					on the
					<a target="_blank" href="https://github.com/smogheap/gravytea">smogheap github page</a>.
				</p>

				<p>Copyright (c) 2013, Micah N Gorrell</p>
			</div>

			<div id="help" class="content">
				<p>At some point I should write some help to go here</p>
			</div>

			<div id="options" class="content">
				<input type="checkbox" disabled id="fullscreen" />Fullscreen<br/>
			</div>

			<div id="level" class="content"></div>
		</div>

		<div id="game">
			<div class="menu">
				<a onclick="showMenu();">Menu</a>
				<div id="gamebuttons"></div>
			</div>

			<div id="hint" class="hint"></div>
		</div>
	</body>
</html>

